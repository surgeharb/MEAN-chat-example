var app=angular.module("chat",["ngRoute","ngSanitize"]);app.config(["$routeProvider","$locationProvider",function(e,n){n.html5Mode(!0),e.when("/:username",{templateUrl:"views/chat/chat.html",controller:"ChatController",title:"Chat"}).otherwise({redirectTo:"/404/"})}]),app.run(["$location","$rootScope",function(e,n){n.$on("$routeChangeSuccess",function(e,r,t){r.hasOwnProperty("$$route")&&(n.title=r.$$route.title)})}]),app.controller("MainCtrl",["$scope",function(e){}]),app.controller("ChatController",["$scope","$location","$routeParams",function(e,n,r){function t(e){return e<10?"0"+e:e}function o(){$("#conversation .body").stop().animate({scrollTop:$("#conversation .body").prop("scrollHeight")},500)}var s="https://scontent-mxp1-1.xx.fbcdn.net/v/t1.0-9/10981992_854381584636591_4594131235025284689_n.jpg?oh=0177b6d4c5e300a93cfa20de639bd235&oe=592BF9D9",a="http://files.sergeharb.com/img/Me.jpg";e.user={name:r.username,username:r.username,profilePicture:a},"cedric"==e.user.username&&(e.user.profilePicture=s);var c=io();c.emit("join",e.user.username),c.on("update",function(e){console.log(e)}),c.on("receive",function(n){if(n.sender==e.user.username)e.conversations[n.receiver].push(n),e.$apply();else{if(n.receiver!=e.user.username)return!1;e.conversations[n.sender].push(n),e.$apply()}}),e.conversations={},"cedric"==e.user.username?(e.chatConversations=[{_id:"123456789abd",name:"Serge Harb",username:"serge",profilePicture:a,lastmessage:{content:"Hello Man",status:"none",date:"22/02/2012 11:12:11"}}],e.conversations.serge=[{date:"22/02/2012 11:12:11",content:"Hello Man",sender:"cedric",receiver:"serge"}]):(e.chatConversations=[{_id:"123456789abc",name:"Cedric Harb",username:"cedric",profilePicture:s,lastmessage:{content:"Hello Man",status:"none",date:"22/02/2012 11:12:11"}}],e.conversations.cedric=[{date:"22/02/2012 11:12:11",content:"Hello Man",sender:"cedric",receiver:"serge"}]),e.conv={},e.conv.user={},e.sendMessage=function(){if(e.message){var n=new Date,r={date:t(n.getDate())+"/"+t(n.getMonth()+1)+"/"+t(n.getFullYear())+" "+t(n.getHours())+":"+t(n.getMinutes())+":"+t(n.getSeconds()),content:e.message,sender:e.user.username,receiver:e.conv.user.username};c.emit("send",r),e.message="",r={},o()}},e.checkEnter=function(n){13===n.keyCode&&e.sendMessage()},e.getTime=function(e){var n=e.split(" ")[1],r=n.split(":");return t(parseInt(r[0]))+":"+t(parseInt(r[1]))},e.fetchConversation=function(n){e.conv.user._id=n._id,e.conv.user.name=n.name,e.conv.user.username=n.username,e.conv.user.profilePicture=n.profilePicture}}]);